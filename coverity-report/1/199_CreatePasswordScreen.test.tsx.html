<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html><head><title>Coverity error reader: /Users/E0661236/Desktop/brightlayer-ui/blui-react/packages/login-workflow/src/screens/CreatePasswordScreen/CreatePasswordScreen.test.tsx</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head>
<body link="#000000" vlink="#000000"><pre>
<b><a name="line1">1    </a></b>	import React, { act } from 'react';
<b><a name="line2">2    </a></b>	import '@testing-library/jest-dom';
<b><a name="line3">3    </a></b>	import { cleanup, render, screen, fireEvent, RenderResult } from '@testing-library/react';
<b><a name="line4">4    </a></b>	import { CreatePasswordScreen } from './CreatePasswordScreen';
<b><a name="line5">5    </a></b>	import { CreatePasswordScreenProps } from './types';
<b><a name="line6">6    </a></b>	import { RegistrationContextProvider } from '../../contexts';
<b><a name="line7">7    </a></b>	import { RegistrationWorkflow } from '../../components';
<b><a name="line8">8    </a></b>	import { registrationContextProviderProps } from '../../testUtils';
<b><a name="line9">9    </a></b>	
<b><a name="line10">10   </a></b>	const passwordRequirements = [
<b><a name="line11">11   </a></b>	    {
<b><a name="line12">12   </a></b>	        description: 'Check 1',
<b><a name="line13">13   </a></b>	        regex: /^.{3,5}$/,
<b><a name="line14">14   </a></b>	    },
<b><a name="line15">15   </a></b>	    {
<b><a name="line16">16   </a></b>	        description: 'Check 2',
<b><a name="line17">17   </a></b>	        regex: /[a-z]+/,
<b><a name="line18">18   </a></b>	    },
<b><a name="line19">19   </a></b>	];
<b><a name="line20">20   </a></b>	
<b><a name="line21">21   </a></b>	afterEach(cleanup);
<b><a name="line22">22   </a></b>	
<b><a name="line23">23   </a></b>	describe('Create Password Screen', () =&gt; {
<b><a name="line24">24   </a></b>	    let mockOnNext: any;
<b><a name="line25">25   </a></b>	    let mockOnPrevious: any;
<b><a name="line26">26   </a></b>	
<b><a name="line27">27   </a></b>	    afterEach(() =&gt; {
<b><a name="line28">28   </a></b>	        jest.clearAllMocks();
<b><a name="line29">29   </a></b>	    });
<b><a name="line30">30   </a></b>	
<b><a name="line31">31   </a></b>	    beforeEach(() =&gt; {
<b><a name="line32">32   </a></b>	        mockOnNext = jest.fn();
<b><a name="line33">33   </a></b>	        mockOnPrevious = jest.fn();
<b><a name="line34">34   </a></b>	    });
<b><a name="line35">35   </a></b>	
<b><a name="line36">36   </a></b>	    const renderer = (props?: CreatePasswordScreenProps): RenderResult =&gt;
<b><a name="line37">37   </a></b>	        render(
<b><a name="line38">38   </a></b>	            &lt;RegistrationContextProvider {...registrationContextProviderProps}&gt;
<b><a name="line39">39   </a></b>	                &lt;RegistrationWorkflow initialScreenIndex={0}&gt;
<b><a name="line40">40   </a></b>	                    &lt;CreatePasswordScreen {...props} /&gt;
<b><a name="line41">41   </a></b>	                &lt;/RegistrationWorkflow&gt;
<b><a name="line42">42   </a></b>	            &lt;/RegistrationContextProvider&gt;
<b><a name="line43">43   </a></b>	        );
<b><a name="line44">44   </a></b>	
<b><a name="line45">45   </a></b>	    it('renders without crashing', () =&gt; {
<b><a name="line46">46   </a></b>	        renderer();
<b><a name="line47">47   </a></b>	
<b><a name="line48">48   </a></b>	        expect(screen.getByText('Create Password')).toBeInTheDocument();
<b><a name="line49">49   </a></b>	    });
<b><a name="line50">50   </a></b>	
<b><a name="line51">51   </a></b>	    it('should display default props', () =&gt; {
<b><a name="line52">52   </a></b>	        renderer();
<b><a name="line53">53   </a></b>	
<b><a name="line54">54   </a></b>	        expect(screen.getByLabelText('Password')).toBeInTheDocument();
<b><a name="line55">55   </a></b>	        expect(screen.getByLabelText('Confirm Password')).toBeInTheDocument();
<b><a name="line56">56   </a></b>	        expect(screen.queryByLabelText('Password')).toBeEmptyDOMElement();
<b><a name="line57">57   </a></b>	        expect(screen.queryByLabelText('Confirm Password')).toBeEmptyDOMElement();
<b><a name="line58">58   </a></b>	    });
<b><a name="line59">59   </a></b>	
<b><a name="line60">60   </a></b>	    it('should display default password requirements', () =&gt; {
<b><a name="line61">61   </a></b>	        renderer();
<b><a name="line62">62   </a></b>	
<b><a name="line63">63   </a></b>	        expect(screen.getByText('8-16 Characters')).toBeInTheDocument();
<b><a name="line64">64   </a></b>	        expect(screen.getByText('One number')).toBeInTheDocument();
<b><a name="line65">65   </a></b>	        expect(screen.getByText('One uppercase letter')).toBeInTheDocument();
<b><a name="line66">66   </a></b>	        expect(screen.getByText('One lowercase letter')).toBeInTheDocument();
<b><a name="line67">67   </a></b>	        expect(screen.getByText('One special character')).toBeInTheDocument();
<b><a name="line68">68   </a></b>	    });
<b><a name="line69">69   </a></b>	
<b><a name="line70">70   </a></b>	    it('should call onNext, when Next button clicked', () =&gt; {
<b><a name="line71">71   </a></b>	        const { getByLabelText } = renderer({
<b><a name="line72">72   </a></b>	            WorkflowCardActionsProps: {
<b><a name="line73">73   </a></b>	                onNext: mockOnNext(),
<b><a name="line74">74   </a></b>	                showNext: true,
<b><a name="line75">75   </a></b>	                nextLabel: 'Next',
<b><a name="line76">76   </a></b>	            },
<b><a name="line77">77   </a></b>	            PasswordProps: {
<b><a name="line78">78   </a></b>	                newPasswordLabel: 'Password',
<b><a name="line79">79   </a></b>	                confirmPasswordLabel: 'Confirm Password',
<b><a name="line80">80   </a></b>	                onPasswordChange: jest.fn(),
<b><a name="line81">81   </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line82">82   </a></b>	            },
<b><a name="line83">83   </a></b>	        });
<b><a name="line84">84   </a></b>	
<b><a name="line85">85   </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line86">86   </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line87">87   </a></b>	
<b><a name="line88">88   </a></b>	        fireEvent.change(passwordField, { target: { value: 'Ab@12' } });
<b><a name="line89">89   </a></b>	        fireEvent.blur(passwordField);
<b><a name="line90">90   </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'Ab@12' } });
<b><a name="line91">91   </a></b>	        fireEvent.blur(confirmPasswordField);
<b><a name="line92">92   </a></b>	
<b><a name="line93">93   </a></b>	        const nextButton = screen.getByText('Next');
<b><a name="line94">94   </a></b>	        expect(nextButton).toBeInTheDocument();
<b><a name="line95">95   </a></b>	        void act(() =&gt; fireEvent.click(nextButton));
<b><a name="line96">96   </a></b>	        expect(mockOnNext).toHaveBeenCalled();
<b><a name="line97">97   </a></b>	    });
<b><a name="line98">98   </a></b>	
<b><a name="line99">99   </a></b>	    it('should enable next button, when passwordRequirements prop is empty', () =&gt; {
<b><a name="line100">100  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line101">101  </a></b>	            WorkflowCardActionsProps: {
<b><a name="line102">102  </a></b>	                onNext: mockOnNext(),
<b><a name="line103">103  </a></b>	                showNext: true,
<b><a name="line104">104  </a></b>	                nextLabel: 'Next',
<b><a name="line105">105  </a></b>	            },
<b><a name="line106">106  </a></b>	            PasswordProps: {
<b><a name="line107">107  </a></b>	                newPasswordLabel: 'Password',
<b><a name="line108">108  </a></b>	                confirmPasswordLabel: 'Confirm Password',
<b><a name="line109">109  </a></b>	                onPasswordChange: jest.fn(),
<b><a name="line110">110  </a></b>	                passwordRequirements: [],
<b><a name="line111">111  </a></b>	            },
<b><a name="line112">112  </a></b>	        });
<b><a name="line113">113  </a></b>	
<b><a name="line114">114  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line115">115  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line116">116  </a></b>	
<b><a name="line117">117  </a></b>	        fireEvent.change(passwordField, { target: { value: 'A' } });
<b><a name="line118">118  </a></b>	        fireEvent.blur(passwordField);
<b><a name="line119">119  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'A' } });
<b><a name="line120">120  </a></b>	        fireEvent.blur(confirmPasswordField);
<b><a name="line121">121  </a></b>	
<b><a name="line122">122  </a></b>	        expect(screen.getByText(/Next/i)).toBeEnabled();
<b><a name="line123">123  </a></b>	    });
<b><a name="line124">124  </a></b>	
<b><a name="line125">125  </a></b>	    it('should call onPrevious, when Back button clicked', () =&gt; {
<b><a name="line126">126  </a></b>	        renderer({
<b><a name="line127">127  </a></b>	            WorkflowCardActionsProps: {
<b><a name="line128">128  </a></b>	                onPrevious: mockOnPrevious(),
<b><a name="line129">129  </a></b>	                showPrevious: true,
<b><a name="line130">130  </a></b>	                previousLabel: 'Back',
<b><a name="line131">131  </a></b>	            },
<b><a name="line132">132  </a></b>	            PasswordProps: {
</pre>
<table summary="events" bgcolor=#e0e0e0>
<tr><td><font color="red">
<a name="error:0"></a>
<a name="error"></a>
<!-- merge-key d1383ead147860f0673a2b86d3103f00 -->
<b>(1) Event Sigma main event</b>: </font></td>
<td><font color="red">A secret, such as a password, cryptographic key, or token is stored in plaintext directly in the source code, in an application's properties, or configuration file. Users with access to the secret may then use the secret to access resources that they otherwise would not have access to. Secret type: Password (generic).</font></td>
</tr>
<tr><td><font color="red">
<a name="error:1"></a>
<!-- merge-key d1383ead147860f0673a2b86d3103f00 -->
<b>(2) Event remediation</b>: </font></td>
<td><font color="red">Avoid setting sensitive configuration values as string literals. Instead, these values should be set using variables with the sensitive data loaded from an encrypted file or a secret store.</font></td>
</tr>
</table>
<pre><b><a name="line133">133  </a></b>	                newPasswordLabel: 'Password',
<b><a name="line134">134  </a></b>	                confirmPasswordLabel: 'Confirm Password',
<b><a name="line135">135  </a></b>	                onPasswordChange: jest.fn(),
<b><a name="line136">136  </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line137">137  </a></b>	            },
<b><a name="line138">138  </a></b>	        });
<b><a name="line139">139  </a></b>	
<b><a name="line140">140  </a></b>	        const backButton = screen.getByText('Back');
<b><a name="line141">141  </a></b>	        expect(backButton).toBeInTheDocument();
<b><a name="line142">142  </a></b>	        expect(screen.getByText(/Back/i)).toBeEnabled();
<b><a name="line143">143  </a></b>	        fireEvent.click(backButton);
<b><a name="line144">144  </a></b>	        expect(mockOnPrevious).toHaveBeenCalled();
<b><a name="line145">145  </a></b>	    });
<b><a name="line146">146  </a></b>	
<b><a name="line147">147  </a></b>	    it('should handle createPassword action error and trigger error', () =&gt; {
<b><a name="line148">148  </a></b>	        const mockCreatePassword = jest.fn().mockRejectedValue(new Error('Password creation failed'));
<b><a name="line149">149  </a></b>	
<b><a name="line150">150  </a></b>	        // Create a custom registrationContextProvider with the failing action
<b><a name="line151">151  </a></b>	        const customRegistrationContextProvider = {
<b><a name="line152">152  </a></b>	            ...registrationContextProviderProps,
<b><a name="line153">153  </a></b>	            actions: {
<b><a name="line154">154  </a></b>	                ...registrationContextProviderProps.actions,
<b><a name="line155">155  </a></b>	                createPassword: mockCreatePassword,
<b><a name="line156">156  </a></b>	            },
<b><a name="line157">157  </a></b>	        };
<b><a name="line158">158  </a></b>	
<b><a name="line159">159  </a></b>	        const { getByLabelText } = render(
<b><a name="line160">160  </a></b>	            &lt;RegistrationContextProvider {...customRegistrationContextProvider}&gt;
<b><a name="line161">161  </a></b>	                &lt;RegistrationWorkflow initialScreenIndex={0}&gt;
<b><a name="line162">162  </a></b>	                    &lt;CreatePasswordScreen
<b><a name="line163">163  </a></b>	                        PasswordProps={{
<b><a name="line164">164  </a></b>	                            passwordRequirements: passwordRequirements,
<b><a name="line165">165  </a></b>	                        }}
<b><a name="line166">166  </a></b>	                    /&gt;
<b><a name="line167">167  </a></b>	                &lt;/RegistrationWorkflow&gt;
<b><a name="line168">168  </a></b>	            &lt;/RegistrationContextProvider&gt;
<b><a name="line169">169  </a></b>	        );
<b><a name="line170">170  </a></b>	
<b><a name="line171">171  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line172">172  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line173">173  </a></b>	
<b><a name="line174">174  </a></b>	        fireEvent.change(passwordField, { target: { value: 'Ab@12' } });
<b><a name="line175">175  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'Ab@12' } });
<b><a name="line176">176  </a></b>	
<b><a name="line177">177  </a></b>	        const nextButton = screen.getByTestId('BluiWorkflowCardActions-nextButton');
<b><a name="line178">178  </a></b>	
<b><a name="line179">179  </a></b>	        act(() =&gt; {
<b><a name="line180">180  </a></b>	            fireEvent.click(nextButton);
<b><a name="line181">181  </a></b>	        });
<b><a name="line182">182  </a></b>	
<b><a name="line183">183  </a></b>	        expect(mockCreatePassword).toHaveBeenCalledWith('Ab@12');
<b><a name="line184">184  </a></b>	    });
<b><a name="line185">185  </a></b>	    it('should call errorDisplayConfig onClose handlers', () =&gt; {
<b><a name="line186">186  </a></b>	        const mockErrorOnClose = jest.fn();
<b><a name="line187">187  </a></b>	
<b><a name="line188">188  </a></b>	        renderer({
<b><a name="line189">189  </a></b>	            errorDisplayConfig: {
<b><a name="line190">190  </a></b>	                onClose: mockErrorOnClose,
<b><a name="line191">191  </a></b>	            },
<b><a name="line192">192  </a></b>	        });
<b><a name="line193">193  </a></b>	
<b><a name="line194">194  </a></b>	        // Since we can't directly access the errorDisplayConfig onClose from the component,
<b><a name="line195">195  </a></b>	        // we'll test that the component renders correctly with the error config
<b><a name="line196">196  </a></b>	        expect(screen.getByText('Create Password')).toBeInTheDocument();
<b><a name="line197">197  </a></b>	    });
<b><a name="line198">198  </a></b>	
<b><a name="line199">199  </a></b>	    it('should call optional WorkflowCardActionsProps.onNext when provided', () =&gt; {
<b><a name="line200">200  </a></b>	        const mockOnNextClick = jest.fn();
<b><a name="line201">201  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line202">202  </a></b>	            WorkflowCardActionsProps: {
<b><a name="line203">203  </a></b>	                onNext: mockOnNextClick,
<b><a name="line204">204  </a></b>	            },
<b><a name="line205">205  </a></b>	            PasswordProps: {
<b><a name="line206">206  </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line207">207  </a></b>	            },
<b><a name="line208">208  </a></b>	        });
<b><a name="line209">209  </a></b>	
<b><a name="line210">210  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line211">211  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line212">212  </a></b>	
<b><a name="line213">213  </a></b>	        fireEvent.change(passwordField, { target: { value: 'Ab@12' } });
<b><a name="line214">214  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'Ab@12' } });
<b><a name="line215">215  </a></b>	
<b><a name="line216">216  </a></b>	        const nextButton = screen.getByText('Next');
<b><a name="line217">217  </a></b>	
<b><a name="line218">218  </a></b>	        act(() =&gt; {
<b><a name="line219">219  </a></b>	            fireEvent.click(nextButton);
<b><a name="line220">220  </a></b>	        });
<b><a name="line221">221  </a></b>	
<b><a name="line222">222  </a></b>	        expect(mockOnNextClick).toHaveBeenCalled();
<b><a name="line223">223  </a></b>	    });
<b><a name="line224">224  </a></b>	
<b><a name="line225">225  </a></b>	    it('should call optional PasswordProps.onSubmit when Enter key is pressed', () =&gt; {
<b><a name="line226">226  </a></b>	        const mockOnSubmit = jest.fn();
<b><a name="line227">227  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line228">228  </a></b>	            PasswordProps: {
<b><a name="line229">229  </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line230">230  </a></b>	                onSubmit: mockOnSubmit,
<b><a name="line231">231  </a></b>	            },
<b><a name="line232">232  </a></b>	        });
<b><a name="line233">233  </a></b>	
<b><a name="line234">234  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line235">235  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line236">236  </a></b>	
<b><a name="line237">237  </a></b>	        fireEvent.change(passwordField, { target: { value: 'Ab@12' } });
<b><a name="line238">238  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'Ab@12' } });
<b><a name="line239">239  </a></b>	
<b><a name="line240">240  </a></b>	        // Simulate pressing Enter key in the confirm password field
<b><a name="line241">241  </a></b>	        fireEvent.keyUp(confirmPasswordField, { key: 'Enter', code: 'Enter', charCode: 13 });
<b><a name="line242">242  </a></b>	
<b><a name="line243">243  </a></b>	        expect(mockOnSubmit).toHaveBeenCalled();
<b><a name="line244">244  </a></b>	    });
<b><a name="line245">245  </a></b>	    it('should use initial password values from PasswordProps', () =&gt; {
<b><a name="line246">246  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line247">247  </a></b>	            PasswordProps: {
<b><a name="line248">248  </a></b>	                initialNewPasswordValue: 'initial123',
<b><a name="line249">249  </a></b>	                initialConfirmPasswordValue: 'confirm123',
<b><a name="line250">250  </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line251">251  </a></b>	            },
<b><a name="line252">252  </a></b>	        });
<b><a name="line253">253  </a></b>	
<b><a name="line254">254  </a></b>	        const passwordField = getByLabelText('Password') as HTMLInputElement;
<b><a name="line255">255  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password') as HTMLInputElement;
<b><a name="line256">256  </a></b>	
<b><a name="line257">257  </a></b>	        expect(passwordField.value).toBe('initial123');
<b><a name="line258">258  </a></b>	        expect(confirmPasswordField.value).toBe('confirm123');
<b><a name="line259">259  </a></b>	    });
<b><a name="line260">260  </a></b>	
<b><a name="line261">261  </a></b>	    it('should call PasswordProps.onPasswordChange when password fields change', () =&gt; {
<b><a name="line262">262  </a></b>	        const mockOnPasswordChange = jest.fn();
<b><a name="line263">263  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line264">264  </a></b>	            PasswordProps: {
<b><a name="line265">265  </a></b>	                onPasswordChange: mockOnPasswordChange,
<b><a name="line266">266  </a></b>	                passwordRequirements: passwordRequirements,
<b><a name="line267">267  </a></b>	            },
<b><a name="line268">268  </a></b>	        });
<b><a name="line269">269  </a></b>	
<b><a name="line270">270  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line271">271  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line272">272  </a></b>	
<b><a name="line273">273  </a></b>	        fireEvent.change(passwordField, { target: { value: 'newPass123' } });
<b><a name="line274">274  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'newPass123' } });
<b><a name="line275">275  </a></b>	
<b><a name="line276">276  </a></b>	        expect(mockOnPasswordChange).toHaveBeenCalledWith({
<b><a name="line277">277  </a></b>	            password: 'newPass123',
<b><a name="line278">278  </a></b>	            confirm: 'newPass123',
<b><a name="line279">279  </a></b>	        });
<b><a name="line280">280  </a></b>	    });
<b><a name="line281">281  </a></b>	
<b><a name="line282">282  </a></b>	    it('should validate passwords with empty requirements array', () =&gt; {
<b><a name="line283">283  </a></b>	        const { getByLabelText } = renderer({
<b><a name="line284">284  </a></b>	            PasswordProps: {
<b><a name="line285">285  </a></b>	                passwordRequirements: [],
<b><a name="line286">286  </a></b>	            },
<b><a name="line287">287  </a></b>	        });
<b><a name="line288">288  </a></b>	
<b><a name="line289">289  </a></b>	        const passwordField = getByLabelText('Password');
<b><a name="line290">290  </a></b>	        const confirmPasswordField = getByLabelText('Confirm Password');
<b><a name="line291">291  </a></b>	
<b><a name="line292">292  </a></b>	        // With empty requirements, any matching passwords should be valid
<b><a name="line293">293  </a></b>	        fireEvent.change(passwordField, { target: { value: 'simple' } });
<b><a name="line294">294  </a></b>	        fireEvent.change(confirmPasswordField, { target: { value: 'simple' } });
<b><a name="line295">295  </a></b>	
<b><a name="line296">296  </a></b>	        const nextButton = screen.getByText('Next');
<b><a name="line297">297  </a></b>	        expect(nextButton).toBeEnabled();
<b><a name="line298">298  </a></b>	    });
<b><a name="line299">299  </a></b>	});
<b><a name="line300">300  </a></b>	


















































</pre></body>
</html>
